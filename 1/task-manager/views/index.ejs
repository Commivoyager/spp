<%- include('partials/header') %>

        <main class="main">
            <!-- –§–æ—Ä–º–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∑–∞–¥–∞—á–∏ -->
            <section class="add-task-section">
                <h2>–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é –∑–∞–¥–∞—á—É</h2>
                <form action="/tasks" method="POST" enctype="multipart/form-data" class="task-form">
                    <div class="form-group">
                        <label for="title">–ù–∞–∑–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏ *</label>
                        <input type="text" id="title" name="title" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="description">–û–ø–∏—Å–∞–Ω–∏–µ</label>
                        <textarea id="description" name="description" rows="3"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="dueDate">–û–∂–∏–¥–∞–µ–º–∞—è –¥–∞—Ç–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è</label>
                        <input type="date" id="dueDate" name="dueDate">
                    </div>
                    
                    <div class="form-group">
                        <label for="attachments">–ü—Ä–∏–∫—Ä–µ–ø–∏—Ç—å —Ñ–∞–π–ª—ã (–¥–æ 5 —Ñ–∞–π–ª–æ–≤)</label>
                        <input type="file" id="attachments" name="attachments" multiple>
                    </div>
                    
                    <button type="submit" class="btn btn-primary">–î–æ–±–∞–≤–∏—Ç—å –∑–∞–¥–∞—á—É</button>
                </form>
            </section>

            <!-- –§–∏–ª—å—Ç—Ä—ã –∏ —Å–ø–∏—Å–æ–∫ –∑–∞–¥–∞—á -->
            <section class="tasks-section">
                <div class="tasks-header">
                    <h2>–°–ø–∏—Å–æ–∫ –∑–∞–¥–∞—á</h2>
                    <div class="filters">
                        <a href="/?filter=all" class="filter-btn <%= currentFilter === 'all' ? 'active' : '' %>">–í—Å–µ</a>
                        <a href="/?filter=active" class="filter-btn <%= currentFilter === 'active' ? 'active' : '' %>">–ê–∫—Ç–∏–≤–Ω—ã–µ</a>
                        <a href="/?filter=completed" class="filter-btn <%= currentFilter === 'completed' ? 'active' : '' %>">–ó–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–µ</a>
                    </div>
                </div>

                <% if (tasks.length === 0) { %>
                    <div class="empty-state">
                        <p>–ó–∞–¥–∞—á–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã. –î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–≤—É—é –∑–∞–¥–∞—á—É!</p>
                    </div>
                <% } else { %>
                    <div class="tasks-list">
                        <% tasks.forEach(task => { %>
                            <div class="task-card <%= task.completed ? 'completed' : '' %>">
                                <div class="task-header">
                                    <h3 class="task-title"><%= task.title %></h3>
                                    <div class="task-actions">
                                        <form action="/tasks/<%= task.id %>/toggle" method="POST" class="toggle-form">
                                            <input type="hidden" name="_method" value="PUT">
                                            <button type="submit" class="btn-toggle <%= task.completed ? 'completed' : '' %>">
                                                <%= task.completed ? '‚úì' : '‚óã' %>
                                            </button>
                                        </form>
                                        <form action="/tasks/<%= task.id %>" method="POST" class="delete-form">
                                            <input type="hidden" name="_method" value="DELETE">
                                            <button type="submit" class="btn-delete">üóëÔ∏è</button>
                                        </form>
                                    </div>
                                </div>
                                
                                <% if (task.description) { %>
                                    <p class="task-description"><%= task.description %></p>
                                <% } %>
                                
                                <div class="task-meta">
                                    <% if (task.dueDate) { %>
                                        <div class="due-date">
                                            <strong>–î–∞—Ç–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è:</strong> 
                                            <%= new Date(task.dueDate).toLocaleDateString('ru-RU') %>
                                        </div>
                                    <% } %>
                                    
                                    <div class="task-status <%= task.completed ? 'status-completed' : 'status-active' %>">
                                        <%= task.completed ? '–ó–∞–≤–µ—Ä—à–µ–Ω–æ' : '–í –ø—Ä–æ—Ü–µ—Å—Å–µ' %>
                                    </div>
                                </div>
                                
                                <% if (task.attachments && task.attachments.length > 0) { %>
                                    <div class="attachments">
                                        <strong>–ü—Ä–∏–∫—Ä–µ–ø–ª–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:</strong>
                                        <ul class="attachments-list">
                                            <% task.attachments.forEach(attachment => { %>
                                                <li>
                                                    <a href="/uploads/<%= attachment.filename %>" 
                                                       download="<%= attachment.originalName %>"
                                                       class="attachment-link">
                                                        üìé <%= attachment.originalName %>
                                                    </a>
                                                </li>
                                            <% }) %>
                                        </ul>
                                    </div>
                                <% } %>
                                
                                <div class="task-date">
                                    –°–æ–∑–¥–∞–Ω–æ: <%= new Date(task.createdAt).toLocaleString('ru-RU') %>
                                </div>
                            </div>
                        <% }) %>
                    </div>
                <% } %>
            </section>
        </main>

<%- include('partials/footer') %>